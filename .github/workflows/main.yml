name: main

on:
  push:
    branches:
      - main

env:
  PYPI_TOKEN_TEST: ${{ secrets.PYPI_TOKEN_TEST }}

jobs:
  build_package_publish:
    name: "init → build → deploy_test"
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@master

      - name: test
        run: |
          make init
          
      - name: build
        run: |
          make version=0.0.$GITHUB_RUN_NUMBER build
          
      - name: deploy_test
        run: |
          make release_test token=$PYPI_TOKEN_TEST
